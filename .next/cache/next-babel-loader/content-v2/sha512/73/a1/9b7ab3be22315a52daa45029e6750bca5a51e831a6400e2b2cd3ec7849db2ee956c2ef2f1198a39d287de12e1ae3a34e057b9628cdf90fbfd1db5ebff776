{"ast":null,"code":"import _taggedTemplateLiteral from \"/Users/ainuratoktomusheva/Documents/Seytech2021/whatsapp-clone/node_modules/next/node_modules/@babel/runtime/helpers/esm/taggedTemplateLiteral\";\nimport { jsxs as _jsxs } from \"react/jsx-runtime\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nimport _defineProperty from \"/Users/ainuratoktomusheva/Documents/Seytech2021/whatsapp-clone/node_modules/next/node_modules/@babel/runtime/helpers/esm/defineProperty\";\nimport _slicedToArray from \"/Users/ainuratoktomusheva/Documents/Seytech2021/whatsapp-clone/node_modules/next/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\n\nfunction _templateObject8() {\n  var data = _taggedTemplateLiteral([\"\\n  margin-bottom: 50px;\\n\"]);\n\n  _templateObject8 = function _templateObject8() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject7() {\n  var data = _taggedTemplateLiteral([\"\\n  flex: 1;\\n  outline: 0;\\n  border: none;\\n  border-radius: 10px;\\n  background-color: whitesmoke;\\n  padding: 20px;\\n  margin-left: 15px;\\n  margin-right: 15px;\\n\"]);\n\n  _templateObject7 = function _templateObject7() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject6() {\n  var data = _taggedTemplateLiteral([\"\\n  display: flex;\\n  align-items: center;\\n  padding: 10px;\\n  position: sticky;\\n  bottom: 0;\\n  background-color: white;\\n  z-index: 100;\\n\"]);\n\n  _templateObject6 = function _templateObject6() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject5() {\n  var data = _taggedTemplateLiteral([\"\\n  padding: 30px;\\n  background-color: #e5ded8;\\n  min-height: 90vh;\\n\"]);\n\n  _templateObject5 = function _templateObject5() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject4() {\n  var data = _taggedTemplateLiteral([\"\"]);\n\n  _templateObject4 = function _templateObject4() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject3() {\n  var data = _taggedTemplateLiteral([\"\\n  margin-left: 15px;\\n  flex: 1;\\n\\n  > h3 {\\n    margin-bottom: 3px;\\n  }\\n\\n  > p {\\n    font-size: 14px;\\n    color: gray;\\n  }\\n\"]);\n\n  _templateObject3 = function _templateObject3() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject2() {\n  var data = _taggedTemplateLiteral([\"\\n  position: sticky;\\n  background-color: white;\\n  z-index: 100;\\n  top: 0;\\n  display: flex;\\n  padding: 11px;\\n  height: 80px;\\n  align-items: center;\\n  border-bottom: 1px solid whitesmoke;\\n\"]);\n\n  _templateObject2 = function _templateObject2() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject() {\n  var data = _taggedTemplateLiteral([\"\\n  display: flex;\\n  flex-direction: column;\\n\"]);\n\n  _templateObject = function _templateObject() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport { useRouter } from \"next/router\";\nimport { useEffect, useRef, useState } from \"react\";\nimport { useAuthState } from \"react-firebase-hooks/auth\";\nimport { useCollection } from \"react-firebase-hooks/firestore\";\nimport styled from \"styled-components\";\nimport { auth, db } from \"../firebase\";\nimport getRecipientEmail from \"../utils/getRecipientEmail\";\nimport firebase from \"firebase\";\nimport TimeAgo from \"timeago-react\";\nimport { Avatar, IconButton } from \"@material-ui/core\";\nimport AttachFileIcon from \"@material-ui/icons/AttachFile\";\nimport InsertEmoticonIcon from \"@material-ui/icons/InsertEmoticon\";\nimport MoreVertIcon from \"@material-ui/icons/MoreVert\";\nimport MicIcon from \"@material-ui/icons/Mic\";\nimport Message from \"./Message\";\n\nfunction ChatScreen(_ref) {\n  var _recipientSnapshot$do, _recipientSnapshot$do2, _recipient$lastSeen, _recipient$lastSeen2;\n\n  var chat = _ref.chat,\n      messages = _ref.messages;\n\n  var _useAuthState = useAuthState(auth),\n      _useAuthState2 = _slicedToArray(_useAuthState, 1),\n      user = _useAuthState2[0];\n\n  var router = useRouter();\n  var endOfMessagesRef = useRef(null);\n\n  var _useState = useState(\"\"),\n      input = _useState[0],\n      setInput = _useState[1];\n\n  var _useCollection = useCollection(db.collection(\"chats\").doc(router.query.id).collection(\"messages\").orderBy(\"timestamp\", \"asc\")),\n      _useCollection2 = _slicedToArray(_useCollection, 1),\n      messagesSnapshot = _useCollection2[0];\n\n  var _useCollection3 = useCollection(db.collection(\"users\").where(\"email\", \"==\", getRecipientEmail(chat.users, user))),\n      _useCollection4 = _slicedToArray(_useCollection3, 1),\n      recipientSnapshot = _useCollection4[0];\n\n  var showMessages = function showMessages() {\n    if (messagesSnapshot) {\n      return messagesSnapshot.docs.map(function (message) {\n        var _message$data$timesta;\n\n        return /*#__PURE__*/_jsx(Message, {\n          user: message.data().user,\n          message: _objectSpread(_objectSpread({}, message.data()), {}, {\n            timestamp: (_message$data$timesta = message.data().timestamp) === null || _message$data$timesta === void 0 ? void 0 : _message$data$timesta.toDate().getTime()\n          })\n        }, message.id);\n      });\n    } else {\n      return JSON.parse(messages).map(function (message) {\n        return /*#__PURE__*/_jsx(Message, {\n          user: message.user,\n          message: message\n        }, message.id);\n      });\n    }\n  };\n\n  var ScrollToBottom = function ScrollToBottom() {\n    endOfMessagesRef.current.scrollIntoView({\n      behavior: \"smooth\",\n      block: \"start\"\n    });\n  };\n\n  var sendMessage = function sendMessage(e) {\n    e.preventDefault();\n    db.collection(\"users\").doc(user.uid).set({\n      lastSeen: firebase.firestore.FieldValue.serverTimestamp()\n    }, {\n      merge: true\n    });\n    db.collection(\"chats\").doc(router.query.id).collection(\"messages\").add({\n      timestamp: firebase.firestore.FieldValue.serverTimestamp(),\n      message: input,\n      user: user.email,\n      photoURL: user.photoURL\n    });\n    setInput(\"\");\n    ScrollToBottom();\n  };\n\n  var recipient = recipientSnapshot === null || recipientSnapshot === void 0 ? void 0 : (_recipientSnapshot$do = recipientSnapshot.docs) === null || _recipientSnapshot$do === void 0 ? void 0 : (_recipientSnapshot$do2 = _recipientSnapshot$do[0]) === null || _recipientSnapshot$do2 === void 0 ? void 0 : _recipientSnapshot$do2.data();\n  var recipientEmail = getRecipientEmail(chat.users, user);\n  return /*#__PURE__*/_jsxs(Container, {\n    children: [/*#__PURE__*/_jsxs(Header, {\n      children: [recipient ? /*#__PURE__*/_jsx(Avatar, {\n        src: recipient === null || recipient === void 0 ? void 0 : recipient.photoURL\n      }) : /*#__PURE__*/_jsx(Avatar, {\n        children: recipientEmail[0]\n      }), /*#__PURE__*/_jsxs(HeaderInformation, {\n        children: [/*#__PURE__*/_jsx(\"h3\", {\n          children: recipientEmail\n        }), recipientSnapshot ? /*#__PURE__*/_jsxs(\"p\", {\n          children: [\"Last active:\", \" \", recipient !== null && recipient !== void 0 && (_recipient$lastSeen = recipient.lastSeen) !== null && _recipient$lastSeen !== void 0 && _recipient$lastSeen.toDate() ? /*#__PURE__*/_jsx(TimeAgo, {\n            datetime: recipient === null || recipient === void 0 ? void 0 : (_recipient$lastSeen2 = recipient.lastSeen) === null || _recipient$lastSeen2 === void 0 ? void 0 : _recipient$lastSeen2.toDate()\n          }) : \"Unavailable\"]\n        }) : /*#__PURE__*/_jsx(\"p\", {\n          children: \"Loading Last active...\"\n        })]\n      }), /*#__PURE__*/_jsxs(HeaderIcons, {\n        children: [/*#__PURE__*/_jsx(IconButton, {\n          children: /*#__PURE__*/_jsx(AttachFileIcon, {})\n        }), /*#__PURE__*/_jsx(IconButton, {\n          children: /*#__PURE__*/_jsx(MoreVertIcon, {})\n        })]\n      })]\n    }), /*#__PURE__*/_jsxs(MessageContainer, {\n      children: [showMessages(), /*#__PURE__*/_jsx(EndOfMessage, {\n        ref: endOfMessagesRef\n      })]\n    }), /*#__PURE__*/_jsxs(InputContainer, {\n      children: [/*#__PURE__*/_jsx(InsertEmoticonIcon, {}), /*#__PURE__*/_jsx(Input, {\n        value: input,\n        onChange: function onChange(e) {\n          return setInput(e.target.value);\n        },\n        type: \"text\"\n      }), /*#__PURE__*/_jsx(\"button\", {\n        hidden: true,\n        disabled: !input,\n        type: \"submit\",\n        onClick: sendMessage,\n        children: \"Send Message\"\n      }), /*#__PURE__*/_jsx(MicIcon, {})]\n    })]\n  });\n}\n\nexport default ChatScreen;\nvar Container = styled.div(_templateObject());\nvar Header = styled.div(_templateObject2());\nvar HeaderInformation = styled.div(_templateObject3());\nvar HeaderIcons = styled.div(_templateObject4());\nvar MessageContainer = styled.div(_templateObject5());\nvar InputContainer = styled.form(_templateObject6());\nvar Input = styled.input(_templateObject7());\nvar EndOfMessage = styled.div(_templateObject8());","map":null,"metadata":{},"sourceType":"module"}